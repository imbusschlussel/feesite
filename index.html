<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Finder's Fee</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <style>
      #cover-image {
        position: absolute;
        left: calc(50vw - 150px);
        top: calc(50vh - 28px);
        width: 300px;
        height: 300px;
      }

      body {
        width: 100vw;
        height: 100vh;
        background-color: #0f0f13;
        overflow: hidden;
        position: relative;
      }
    </style>
  </head>
  <body>
    <img id="cover-image" src="cover.webp" alt="Album cover" onclick="play()" />
    <audio id="audio" src="./atf_tfop.mp3" />
    <script>
      function play() {
        const audioElement = document.querySelector("#audio")
        audioElement.play()
      }

      const body = document.querySelector('body')
      const image = document.querySelector('#cover-image')

      let colors = [ '#26de81', '#fc5c65', '#fd9644', '#fed330', '#2bcbba', '#45aaf2', '#4b7bec', '#a55eea', '#ffc1f3', '#76ead7', '#ff9c71', '#32e0c4', '#d291bc', '#fa744f' ]

      let FPS = 60

      let width
        , height
        , velocityX = 1
        , velocityY = 1
        , pause = true
        , previousColor = 0
      ;

      setInterval(() => {
        if (pause) return;

        let rect = image.getBoundingClientRect()

        let left = rect.x
        let top = rect.y

        if (left + rect.width >= width || left <= 0) {
          velocityX = -velocityX
          let randomColor = getRandomColor()
          image.style.stroke = randomColor
          
          if (left + 150 <= width / 2) {
            body.style.boxShadow = `inset 4px 0px 0px 0px ${randomColor}`
          } else {
            body.style.boxShadow = `inset -4px 0px 0px 0px ${randomColor}`
          }
        }
        if (top + rect.height >= height || top <= 0) {
          velocityY = -velocityY
          let randomColor = getRandomColor()
          image.style.stroke = randomColor
          
          if (top + 28 <= height / 2) {
            body.style.boxShadow = `inset 0px 4px 0px 0px ${randomColor}`
          } else {
            body.style.boxShadow = `inset 0px -4px 0px 0px ${randomColor}`
          }
        }

        image.style.left = rect.x + velocityX + 'px'
        image.style.top = rect.y + velocityY + 'px'
      }, 1000 / FPS)


      const reset = () => {
        width =
          window.innerWidth ||
          document.documentElement.clientWidth ||
          document.body.clientWidth
        ;

        height =
          window.innerHeight ||
          document.documentElement.clientHeight ||
          document.body.clientHeight
        ;

        pause =
          width <= image.getBoundingClientRect().width ||
          height <= image.getBoundingClientRect().height
        ;

        label.style.left = 'calc(50vw - 150px)'
        label.style.top = 'calc(50vh - 28px)'
        label.style.stroke = colors[0]
      }


      const getRandomColor = () => {
        let currentColor = -1
        
        do {
          currentColor = Math.floor(Math.random() * colors.length);
        } while (previousColor == currentColor);
        
        previousColor = currentColor
        
        return colors[currentColor]
      }

      reset()

      window.addEventListener('resize', reset, true)
    </script>
  </body>
</html>
